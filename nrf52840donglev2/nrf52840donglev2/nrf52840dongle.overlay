/*
 * nrf52840dongle.overlay
 *
 * Goals (NCS 3.2.1 / Zephyr 4.2.x):
 * - USB CDC ACM command channel (legacy USB device stack)
 * - Use the board's existing fixed-partitions 'storage_partition' for settings
 *   (so BT bonds/CCCs persist)
 *
 * IMPORTANT:
 * - Do NOT add a second partition with label="storage". The board already has
 *   one, and duplicates can break settings init.
 */

&board_cdc_acm_uart {
    status = "disabled";
};

&usbd {
	status = "okay";

	/* ACM0 = CMD (enumerates first, clean command channel) */
	cdc_acm_uart0: cdc_acm_uart0 {
		compatible = "zephyr,cdc-acm-uart";
		status = "okay";
	};

	/* ACM1 = LOG (disabled) */
	cdc_acm_uart1: cdc_acm_uart1 {
		compatible = "zephyr,cdc-acm-uart";
		status = "disabled";
	};
};

/ {
    chosen {
        /* Keep settings persistence */
        zephyr,settings-partition = &storage_partition;

        /* Re-point any board defaults at our single CDC ACM (harmless even if console/shell disabled) */
        zephyr,console = &cdc_acm_uart0;
        zephyr,shell-uart = &cdc_acm_uart0;
        zephyr,uart-mcumgr = &cdc_acm_uart0;
        zephyr,bt-mon-uart = &cdc_acm_uart0;
        zephyr,bt-c2h-uart = &cdc_acm_uart0;
    };

    aliases {
        pihub-cmd-uart = &cdc_acm_uart0;
    };
};